# Custom Commands
You can alter any of the command(s) generated by ORM mappers by replacing it with your own implementation or by creating command chain.

## Hook into Insert/User/Delete command
To add your own handler when entity is created, updated or deleted. Modify the methods `queueCreate`, `queueUpdate` and `queueDelete` of
your entity wrapper.

```php
class MyMapper extends Mapper
{
    public function queueCreate($entity, Node $node, State $state): ContextCarrierInterface
    {
        $cmd = parent::queueCreate($entity, $node, $state);
        return $cmd;
    }

    public function queueUpdate($entity, Node $node, State $state): ContextCarrierInterface
    {
        $cmd = parent::queueUpdate($entity, $node, $state);
        return $cmd;
    }
```

And assign the entity to specific mapper:

```php
/**
 * @entity(mapper=MyMapper)
 */
class User 
{
   //...
}
```

## Create Command Chain
We can link another command to be executed right after `$cmd`:

```php
public function queueCreate($entity, Node $node, State $state): ContextCarrierInterface
{
    $cmd = parent::queueCreate($entity, $node, $state);

    $cs = new ContextSequence();
    $cs->addPrimary($cmd);
    $cs->addCommand(new OurCommand());

    return $cs;
}
```

In case of Create, the primary key sequence won't be avaible at moment of `queueCreate`, this value must be forwarded to our
command using `forward` method:

```php
public function queueCreate($entity, Node $node, State $state): ContextCarrierInterface
{
    $cmd = parent::queueCreate($entity, $node, $state);
    $our = new OurCommand();

    // wait for cmd_id value or fail
    $our->waitContext('cmd_id', true);
    
    // send lastID value as cmd_id to $our command
    $cmd->forward(Insert::INSERT_ID, $our, 'cmd_id');

    $cs = new ContextSequence();
    $cs->addPrimary($cmd);
    $cs->addCommand($our);

    return $cs;
}
```

> Example: see [sample implementation](https://github.com/cycle/orm/blob/master/tests/ORM/Fixtures/SnapshotMapper.php) which copies all entity changes into separate table.
