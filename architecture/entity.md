# Entity, Heap, Node, State
The Cycle ORM architecture separates entity representation (data carrying object), entity data (node) and current dta changes (state).
In a simplest form the entity lifecycle can be describe as following:

<img width="826" alt="Screenshot_29" src="https://user-images.githubusercontent.com/796136/56358587-c3b0e300-61e7-11e9-87f8-c999554f201e.png">

## Entity
The Entity object is, technically, any object used to carry data (including relation data). By default Cycle relies on separate class for each of the entity, however, it is possible to use `stdClass` or same class for multiple entities. This can be achieved by associating entity with custom mappers and giving them different roles. Upon `persist` operation, the Mapper object must extract entity values and generate desired State associated with entity Node.

## Node
Node is the internal object used to represent any entity in the system. Node used only to carry entity information such as current set of relations, entity role and it's data. Each entity always have one Node object associated with it (however, Node might not exists till first persist operation).

## State
Node State represents changes generated by mappers and used to repsent the desired state of the data. In addition to that, State links some of the entity fields to the external contexts (for example FK from the relation). The State exists only during the Transaction lifecycle. 

If transaction succcessed the State data will be merged with parent Node object to sync Heap state with persistent storage. In case of transaction failure the State will be deleted, keeping the Node in original (pre-transaction) form.

## Heap
The Heap used to store all loaded entity Nodes and their current states (if any). By design, heap operates as hash table in which entity is the key and node is value. 
